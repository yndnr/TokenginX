# 核心架构

## 分片存储架构

- **256 分片设计**：减少锁竞争，充分利用多核 CPU
- 每个分片独立管理一部分会话数据
- 使用一致性哈希进行分片路由

## 缓存层设计

- **W-TinyLFU 算法**：业界领先的缓存淘汰策略，命中率 > 99%
- 内存优先，热数据常驻内存
- 冷数据自动溢出到磁盘（使用 mmap 内存映射）

## TTL 管理

- **惰性删除**：访问时检查过期
- **定期清理**：后台任务定期扫描过期数据
- 专门为会话过期场景优化

## 持久化机制

- **mmap 内存映射文件**：高效的磁盘访问
- **WAL（Write-Ahead Log）**：保证数据持久性
- **数据压缩**：支持 LZ4/Snappy 压缩算法

## 多协议支持

### OAuth 2.0 / OIDC

- Authorization Code Flow
- Implicit Flow
- Client Credentials Flow
- Token Introspection (RFC 7662)
- 存储：Access Token、Refresh Token、ID Token、授权码

### SAML 2.0

- SP-initiated SSO
- IdP-initiated SSO
- Artifact Binding
- 存储：SAML Assertion、Session Index、Name ID

### CAS

- TGT (Ticket Granting Ticket)
- ST (Service Ticket)
- PT (Proxy Ticket)

## 多接口通信

### TCP (RESP 协议)

- 兼容 Redis 协议，可使用 Redis 客户端连接
- 高性能二进制协议

### gRPC

- 高性能 RPC 框架
- 支持双向流
- 适合微服务架构

### HTTP/REST

- 通用 RESTful API
- 易于集成和调试

## 分布式集群（v2.0.0+）

- **Gossip 协议**：去中心化节点发现和故障检测
- **Quorum 副本同步**：法定人数复制保证一致性
- **自动故障转移**：副本自动提升为主节点
- **分片集群**：水平扩展支持
