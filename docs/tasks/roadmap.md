# TokenginX 项目路线图

本文档定义了 TokenginX 从 MVP 到企业版的完整开发路线图。

## 版本概览

| 版本 | 目标 | 预计时间 | 状态 |
|-----|------|---------|------|
| v0.1.0 | MVP - 单机 + OAuth 基础 | Q1 2025 | 🚧 进行中 |
| v0.5.0 | 完整协议支持 | Q2 2025 | 📋 计划中 |
| v1.0.0 | 生产可用 | Q3 2025 | 📋 计划中 |
| v2.0.0 | 分布式集群 | Q4 2025 | 📋 计划中 |
| v3.0.0 | 企业版 | Q1 2026 | 📋 计划中 |

## v0.1.0 - MVP (最小可用产品)

**目标**: 提供基本的会话存储功能和 OAuth 2.0 支持

**发布标准**:
- 单机部署可用
- 支持基础 OAuth 2.0 流程
- QPS > 50,000
- 基础文档完备

### 核心功能

#### 1. 存储引擎 (Storage Engine)

**优先级**: P0 (最高)

- [ ] **分片哈希表** `[8h]`
  - [ ] 实现 256 分片的 ShardedMap
  - [ ] 实现基于 FNV-1a 的哈希函数
  - [ ] 实现分片锁机制（RWMutex）
  - [ ] 单元测试：并发读写测试
  - [ ] 基准测试：QPS 测试

- [ ] **TTL 管理** `[6h]`
  - [ ] 实现 TTL 数据结构（过期时间存储）
  - [ ] 实现惰性删除（访问时检查）
  - [ ] 实现定期清理（后台 goroutine）
  - [ ] 单元测试：过期测试
  - [ ] 单元测试：边界情况

- [ ] **缓存算法（基础）** `[4h]`
  - [ ] 实现 LRU 缓存（作为 v0.1.0 默认）
  - [ ] 实现缓存统计（命中率、淘汰次数）
  - [ ] 单元测试：缓存行为测试

- [ ] **内存管理** `[3h]`
  - [ ] 实现内存使用统计
  - [ ] 实现内存阈值检查
  - [ ] 实现简单的淘汰策略

#### 2. 传输层 (Transport Layer)

**优先级**: P0

- [ ] **TCP (RESP 协议)** `[12h]`
  - [ ] 实现 RESP 协议解析器
  - [ ] 实现基础命令：GET, SET, DEL, EXISTS, TTL
  - [ ] 实现 SETEX, EXPIRE 命令
  - [ ] 实现连接池管理
  - [ ] 实现超时机制
  - [ ] 单元测试：协议解析测试
  - [ ] 集成测试：Redis 客户端兼容性

- [ ] **HTTP/REST API** `[8h]`
  - [ ] 实现 REST API 框架（使用 gorilla/mux 或 chi）
  - [ ] 实现 GET /api/v1/sessions/:key
  - [ ] 实现 POST /api/v1/sessions
  - [ ] 实现 DELETE /api/v1/sessions/:key
  - [ ] 实现 HEAD /api/v1/sessions/:key
  - [ ] 实现 /health 健康检查端点
  - [ ] API 文档（OpenAPI/Swagger）

- [ ] **gRPC（基础）** `[6h]`
  - [ ] 定义 Protocol Buffers
  - [ ] 实现基础 gRPC 服务
  - [ ] 实现 Get, Set, Delete RPC
  - [ ] 集成测试

#### 3. OAuth 2.0 支持

**优先级**: P0

- [ ] **Access Token 管理** `[4h]`
  - [ ] 实现 Token 存储结构
  - [ ] 实现 Token 验证接口
  - [ ] 实现 Token 过期检查
  - [ ] 单元测试

- [ ] **Refresh Token 管理** `[3h]`
  - [ ] 实现 Refresh Token 存储
  - [ ] 实现 Token 刷新接口
  - [ ] 单元测试

- [ ] **Authorization Code** `[3h]`
  - [ ] 实现授权码存储
  - [ ] 实现一次性使用验证
  - [ ] 实现短过期时间（5分钟）
  - [ ] 单元测试

#### 4. 配置系统

**优先级**: P0

- [ ] **配置文件解析** `[4h]`
  - [ ] 实现 YAML 配置解析
  - [ ] 定义配置结构（server, storage, protocols）
  - [ ] 实现配置验证
  - [ ] 实现默认配置

- [ ] **环境变量支持** `[2h]`
  - [ ] 实现环境变量覆盖
  - [ ] 实现敏感信息环境变量（密钥等）

#### 5. 命令行工具

**优先级**: P1

- [ ] **tokenginx-server** `[6h]`
  - [ ] 实现命令行参数解析
  - [ ] 实现启动流程
  - [ ] 实现优雅关闭
  - [ ] 实现信号处理
  - [ ] 实现版本信息

- [ ] **tokenginx-client** `[4h]`
  - [ ] 实现基础客户端命令
  - [ ] 实现 ping 命令
  - [ ] 实现统计查询命令

#### 6. 日志系统

**优先级**: P1

- [ ] **结构化日志** `[3h]`
  - [ ] 集成 zap 或 zerolog
  - [ ] 实现日志级别配置
  - [ ] 实现日志格式配置（JSON/Text）
  - [ ] 实现日志输出配置（stdout/file）

#### 7. 监控（基础）

**优先级**: P2

- [ ] **基础指标** `[4h]`
  - [ ] 实现 QPS 统计
  - [ ] 实现延迟统计（P50/P99）
  - [ ] 实现连接数统计
  - [ ] 实现内存使用统计

- [ ] **健康检查** `[2h]`
  - [ ] 实现健康检查端点
  - [ ] 实现存储健康检查
  - [ ] 实现 TTL 清理健康检查

#### 8. 测试

**优先级**: P0

- [ ] **单元测试** `[20h]`
  - [ ] 存储引擎测试（覆盖率 > 80%）
  - [ ] 传输层测试
  - [ ] OAuth 协议测试
  - [ ] 并发测试
  - [ ] 数据竞争检测

- [ ] **集成测试** `[10h]`
  - [ ] 端到端测试
  - [ ] Redis 客户端兼容性测试
  - [ ] HTTP API 测试
  - [ ] gRPC 测试

- [ ] **基准测试** `[8h]`
  - [ ] QPS 基准测试
  - [ ] 延迟基准测试
  - [ ] 内存使用基准测试
  - [ ] 并发性能测试

#### 9. 文档

**优先级**: P1

- [x] **项目文档** `[完成]`
  - [x] readme.md
  - [x] contributing.md
  - [x] changelog.md
  - [x] claude.md

- [x] **用户文档** `[完成]`
  - [x] 快速开始指南（8种语言）
  - [x] API 参考文档
  - [x] 配置参考

- [x] **部署文档** `[完成]`
  - [x] Docker 部署指南
  - [x] Podman 部署指南
  - [x] Kubernetes 部署指南

#### 10. 构建和发布

**优先级**: P1

- [ ] **CI/CD** `[6h]`
  - [ ] GitHub Actions 配置
  - [ ] 多平台构建（Linux/macOS/Windows）
  - [ ] 自动化测试
  - [ ] 代码覆盖率报告

- [ ] **发布流程** `[4h]`
  - [ ] 版本标签管理
  - [ ] GitHub Release 自动创建
  - [ ] 构建产物上传
  - [ ] Docker 镜像构建和推送

### 时间估算

- **总开发时间**: 约 140 小时（~18 工作日）
- **测试时间**: 约 38 小时（~5 工作日）
- **文档时间**: 已完成
- **总计**: 约 178 小时（~23 工作日）

### v0.1.0 发布检查清单

- [ ] 所有 P0 功能完成
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试通过
- [ ] 基准测试显示 QPS > 50,000
- [ ] 文档完备
- [ ] Docker 镜像可用
- [ ] 至少 2 个示例项目
- [ ] 安全审计（基础）
- [ ] 性能测试报告
- [ ] 发布说明完成

---

## v0.5.0 - 完整协议支持

**目标**: 支持 SAML 2.0、CAS 协议，完善三种传输接口

**发布标准**:
- 支持 OAuth/SAML/CAS 三种协议
- 三种传输接口完整实现
- QPS > 80,000
- 支持基础持久化

### 核心功能

#### 1. 协议扩展

- [ ] **SAML 2.0 支持** `[20h]`
  - [ ] SAML Assertion 存储
  - [ ] Session Index 管理
  - [ ] SP-initiated SSO
  - [ ] IdP-initiated SSO
  - [ ] Artifact Binding

- [ ] **CAS 协议支持** `[15h]`
  - [ ] TGT (Ticket Granting Ticket)
  - [ ] ST (Service Ticket)
  - [ ] PT (Proxy Ticket)
  - [ ] Ticket 验证接口

- [ ] **OAuth 2.0 完善** `[10h]`
  - [ ] Implicit Flow
  - [ ] Client Credentials Flow
  - [ ] PKCE 支持
  - [ ] ID Token 管理（OIDC）
  - [ ] Token Introspection (RFC 7662)

#### 2. 缓存优化

- [ ] **W-TinyLFU 算法** `[16h]`
  - [ ] 实现 TinyLFU 频率估计
  - [ ] 实现 Window Cache
  - [ ] 实现 Main Cache (SLRU)
  - [ ] 性能优化
  - [ ] 基准测试对比

#### 3. 持久化（基础）

- [ ] **mmap 文件** `[12h]`
  - [ ] 实现内存映射文件管理
  - [ ] 实现冷热数据分离
  - [ ] 实现数据序列化
  - [ ] 实现数据恢复

- [ ] **WAL（基础）** `[10h]`
  - [ ] 实现 Write-Ahead Log
  - [ ] 实现日志写入
  - [ ] 实现日志恢复
  - [ ] 实现日志截断

#### 4. gRPC 完善

- [ ] **完整 gRPC 服务** `[8h]`
  - [ ] 实现流式 RPC
  - [ ] 实现批量操作
  - [ ] 实现 gRPC 健康检查
  - [ ] 实现 gRPC 反射

#### 5. 监控扩展

- [ ] **Prometheus Metrics** `[6h]`
  - [ ] 实现完整的 metrics 导出
  - [ ] 实现协议级指标
  - [ ] 实现缓存指标
  - [ ] 创建 Grafana Dashboard

### 时间估算

- **总开发时间**: 约 97 小时（~12 工作日）
- **测试时间**: 约 30 小时（~4 工作日）
- **总计**: 约 127 小时（~16 工作日）

---

## v1.0.0 - 生产可用

**目标**: 完整的安全特性，生产级稳定性

**发布标准**:
- 完整的安全加固
- QPS > 100,000
- P99 < 1ms, P999 < 5ms
- 生产环境文档完备

### 核心功能

#### 1. 安全特性

- [ ] **TLS/mTLS** `[10h]`
  - [ ] TLS 1.3 支持
  - [ ] 客户端证书验证
  - [ ] 证书热更新

- [ ] **国密算法** `[20h]`
  - [ ] SM2/SM3/SM4 集成
  - [ ] 国密 TLS (TLCP)
  - [ ] 双证书模式
  - [ ] 性能优化

- [ ] **防重放攻击** `[12h]`
  - [ ] 时间戳验证
  - [ ] Nonce 缓存
  - [ ] 请求签名（HMAC-SHA256/SM3）
  - [ ] 序列号机制

- [ ] **访问控制 (ACL)** `[16h]`
  - [ ] 角色定义（admin/operator/readonly）
  - [ ] 命令级权限
  - [ ] 键级权限
  - [ ] IP 白名单/黑名单
  - [ ] 时间窗口控制
  - [ ] 动态 ACL API

- [ ] **数据加密** `[14h]`
  - [ ] 内存数据加密（AES-256-GCM/SM4-GCM）
  - [ ] 持久化数据加密
  - [ ] 密钥管理
  - [ ] 密钥轮换
  - [ ] KMS 集成

- [ ] **审计日志** `[8h]`
  - [ ] 结构化审计日志
  - [ ] 安全事件记录
  - [ ] Syslog 集成
  - [ ] 日志加密

- [ ] **速率限制** `[6h]`
  - [ ] 全局限流
  - [ ] 用户限流
  - [ ] IP 限流
  - [ ] 命令限流

#### 2. 持久化完善

- [ ] **WAL 完整实现** `[8h]`
  - [ ] 数据压缩
  - [ ] 快照机制
  - [ ] 数据完整性校验

- [ ] **数据备份** `[6h]`
  - [ ] 热备份
  - [ ] 增量备份
  - [ ] 自动备份

#### 3. 性能优化

- [ ] **零拷贝优化** `[8h]`
- [ ] **内存池** `[6h]`
- [ ] **批量操作** `[4h]`
- [ ] **连接复用** `[4h]`

#### 4. 运维工具

- [ ] **数据迁移工具** `[8h]`
- [ ] **配置热更新** `[6h]`
- [ ] **性能诊断工具** `[6h]`

### 时间估算

- **总开发时间**: 约 142 小时（~18 工作日）
- **安全审计**: 约 40 小时（~5 工作日）
- **性能测试**: 约 24 小时（~3 工作日）
- **总计**: 约 206 小时（~26 工作日）

---

## v2.0.0 - 分布式集群

**目标**: 支持分布式部署，高可用

**发布标准**:
- 支持多节点集群
- 自动故障转移
- 集群 QPS > 1,000,000
- 可用性 > 99.99%

### 核心功能

- [ ] **Gossip 协议** `[20h]`
- [ ] **Quorum 副本同步** `[24h]`
- [ ] **自动故障转移** `[16h]`
- [ ] **数据分片** `[20h]`
- [ ] **一致性哈希** `[12h]`
- [ ] **集群管理 CLI** `[16h]`

### 时间估算

- **总开发时间**: 约 108 小时（~14 工作日）
- **集群测试**: 约 40 小时（~5 工作日）
- **总计**: 约 148 小时（~19 工作日）

---

## v3.0.0 - 企业版

**目标**: 企业级特性，完整监控

**发布标准**:
- 完整的 Prometheus 监控
- Grafana Dashboard
- 支持 1000+ 节点
- 企业级技术支持

### 核心功能

- [ ] **完整监控系统** `[24h]`
- [ ] **可视化管理界面** `[40h]`
- [ ] **自动化运维** `[32h]`
- [ ] **硬件国密卡支持** `[20h]`
- [ ] **多租户支持** `[24h]`

### 时间估算

- **总开发时间**: 约 140 小时（~18 工作日）

---

## 优先级说明

- **P0**: 必须有，阻碍发布
- **P1**: 应该有，重要但不阻碍发布
- **P2**: 可以有，锦上添花
- **P3**: 未来考虑

## 依赖关系

```
v0.1.0 (MVP)
    ↓
v0.5.0 (完整协议)
    ↓
v1.0.0 (生产可用)
    ↓
v2.0.0 (分布式)
    ↓
v3.0.0 (企业版)
```

## 资源分配建议

### v0.1.0 MVP
- **核心开发**: 2 人
- **测试**: 1 人
- **文档**: 已完成（AI辅助）
- **时间**: 1.5 月

### v0.5.0
- **核心开发**: 2-3 人
- **协议专家**: 1 人
- **测试**: 1 人
- **时间**: 1 月

### v1.0.0
- **核心开发**: 2-3 人
- **安全专家**: 1 人
- **测试**: 1-2 人
- **时间**: 1.5 月

### v2.0.0
- **核心开发**: 3-4 人
- **分布式专家**: 1 人
- **测试**: 2 人
- **时间**: 1.5 月

### v3.0.0
- **全栈开发**: 2 人（前端）
- **后端开发**: 2 人
- **DevOps**: 1 人
- **时间**: 1.5 月

## 风险评估

| 风险 | 影响 | 概率 | 缓解措施 |
|-----|------|------|---------|
| 性能不达标 | 高 | 中 | 提前性能测试，算法优化 |
| 安全漏洞 | 高 | 中 | 安全审计，渗透测试 |
| 协议兼容性问题 | 中 | 中 | 参考标准实现，充分测试 |
| 集群一致性 Bug | 高 | 高 | Jepsen 测试，混沌工程 |
| 国密算法性能 | 中 | 中 | 硬件加速，算法优化 |

## 更新日志

- 2025-01-19: 初始版本，定义 v0.1.0 - v3.0.0 路线图
