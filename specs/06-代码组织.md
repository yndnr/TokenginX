# 代码组织

## 推荐目录结构

```
tokenginx/
├── .github/
│   ├── workflows/       # GitHub Actions CI/CD 配置
│   ├── ISSUE_TEMPLATE/  # Issue 模板
│   └── PULL_REQUEST_TEMPLATE.md
├── cmd/
│   ├── server/          # tokenginx-server 主程序
│   └── client/          # tokenginx-client 主程序
├── internal/
│   ├── storage/         # 存储引擎（分片、缓存、持久化）
│   ├── protocol/        # 协议实现（OAuth、SAML、CAS）
│   ├── transport/       # 传输层（TCP/RESP、gRPC、HTTP）
│   ├── security/        # 安全模块（TLS、国密、ACL）
│   ├── cluster/         # 集群模块（Gossip、副本同步）
│   └── monitoring/      # 监控模块（Prometheus、审计日志）
├── pkg/                 # 可导出的公共库
├── api/                 # API 定义（gRPC proto、OpenAPI）
├── config/              # 配置文件示例
├── scripts/             # 构建和部署脚本
├── specs/               # 规范文档
├── docs/                # 文档
├── .gitignore           # Git 忽略文件
├── .golangci.yml        # golangci-lint 配置
├── go.mod               # Go 模块定义
├── go.sum               # Go 依赖锁定
├── Makefile             # 构建自动化
├── LICENSE              # 开源许可证
├── readme.md            # 项目说明
├── contributing.md      # 贡献指南
├── changelog.md         # 版本变更日志
└── claude.md            # Claude Code 指南（索引文件）
```

## 关键模块说明

### internal/storage/

- `sharded_map.go`：256 分片的核心存储结构
- `wtinylfu.go`：W-TinyLFU 缓存算法实现
- `mmap.go`：内存映射文件管理
- `wal.go`：Write-Ahead Log 实现
- `ttl.go`：TTL 管理和过期清理

### internal/protocol/

- `oauth/`：OAuth 2.0/OIDC 实现
- `saml/`：SAML 2.0 实现
- `cas/`：CAS 协议实现
- `common.go`：协议公共接口和类型

### internal/transport/

- `resp/`：Redis RESP 协议实现
- `grpc/`：gRPC 服务实现
- `http/`：HTTP/REST API 实现

### internal/security/

- `tls.go`：TLS/mTLS 配置
- `sm2.go`、`sm3.go`、`sm4.go`：国密算法实现
- `acl.go`：访问控制列表
- `audit.go`：审计日志
