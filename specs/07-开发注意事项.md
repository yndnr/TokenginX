# 开发注意事项

## 性能优化

- 使用 `sync.Pool` 减少内存分配
- 避免在热路径上使用反射
- 优先使用 `[]byte` 而非 `string` 减少拷贝
- 使用 `atomic` 包进行无锁操作
- 性能关键路径使用 `//go:inline` 提示

## 并发安全

- 256 分片减少锁竞争，但每个分片内仍需加锁
- 优先使用 `sync.RWMutex` 读写分离
- 注意 Goroutine 泄漏，使用 context 控制生命周期

## 测试要求

- 单元测试覆盖率 > 80%
- 关键路径需要基准测试
- 使用 `go test -race` 检测数据竞争
- 集成测试覆盖所有协议和接口

## 国密集成

- 使用 `github.com/tjfoc/gmsm` 库实现国密算法
- 在 TLS 握手中支持国密套件
- 数据加密优先使用 SM4（对称）+ SM2（非对称）

## 错误处理

- 使用 `errors.Wrap` 提供错误上下文
- 关键错误记录详细日志
- 区分可恢复错误和致命错误
